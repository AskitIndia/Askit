<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup & Google Login</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <h2>Sign Up</h2>
    <form id="signupForm">
        <label for="signupUsername">Username:</label>
        <input type="text" id="signupUsername" required><br>

        <label for="signupEmail">Email:</label>
        <input type="email" id="signupEmail" required><br>

        <label for="signupPassword">Password:</label>
        <input type="password" id="signupPassword" required><br>

        <label for="confirmPassword">Confirm Password:</label>
        <input type="password" id="confirmPassword" required><br>

        <button type="submit">Sign Up</button>
    </form>

    <h3>Or Sign in with Google</h3>
    <div id="googleLoginButton"></div>

    <script>
    document.getElementById('signupForm').addEventListener('submit', async (event) => {
        event.preventDefault();
        alert("Signing up... Please wait.");

        const username = document.getElementById('signupUsername').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        const response = await fetch('/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email, password })
        });

        const data = await response.json();
        if (data.success) {
            alert("Signup successful! Redirecting...");
            window.location.href = '/login.html';
        } else {
            alert("Signup failed: " + data.error);
        }
    });

    // Google Login Handler
    function handleCredentialResponse(response) {
        console.log("Encoded JWT ID token: " + response.credential);
        
        fetch('/google-login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: response.credential })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                alert("Google Login Successful! Redirecting...");
                window.location.href = "/dashboard.html";  // Redirect after login
            } else {
                alert("Google Login Failed!");
            }
        })
        .catch(error => console.error("Google login error:", error));
    }

    // Load Google Sign-In
    window.onload = function () {
        google.accounts.id.initialize({
            client_id: "YOUR_GOOGLE_CLIENT_ID",
            callback: handleCredentialResponse
        });

        google.accounts.id.renderButton(
            document.getElementById("googleLoginButton"),
            { theme: "outline", size: "large" }
        );
    };
    </script>

</body>
</html>
